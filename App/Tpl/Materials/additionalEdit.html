<include file="Public:header" />
<style type="text/css">
    .add_title{
        padding-bottom:10px;
        height: 60px;
        margin-bottom:15px;
    }
    .add_title>span{
        border-bottom: 2px solid #1ab394;
        font-size: 24px;
    }
    .add_body >div >.full-height-scroll{
        border-right:1px dotted #ccc
    }
    .add_body_title{
        margin:15px auto 30px auto;
        padding-left: 14px;
    }
    .add_body_form>form>.form-group{
        margin-bottom: 25px;
    }
    body{overflow-y:hidden;}
    .form-control{
        float:left;
    }

    .select2-container--default .select2-selection--single {
        border-radius: 0px !important;
        border: 1px solid #d8e3ef !important;
    }
    .select2-container .select2-selection--single{
        height: 35px !important;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow{
        height: 35px !important;
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered{
        line-height: 35px !important;
    }
</style>
<link rel="stylesheet" href="__PUBLIC__/css/jquery.fileupload.css" type="text/css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script>
    $(function(){
        $(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
        $(window).resize(function(){
            $(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
        })
    })
</script>
<div class="wrapper wrapper-content animated fadeIn col-md-6">
    <form class="form-horizontal" id="form" role="form" action="{:U('materials/additionalEdit')}" method="post" enctype="multipart/form-data">
        <div class="ibox-content " id="add_body" >
            <div class="row">
                <div class="col-md-12 add_body">
                    <div class="full-height-scroll">
                        <div class="row" >
                            <div class="col-md-12 add_body_title" style="margin:20px 0 0 0px;">
                                <div class="all-inline">
                                    <span class="sq-tag"></span>
                                    <div class="text-tag">
                                        <span>基础信息</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10 add_body_form" style="margin:20px 0 0 21px;">
                                <div class="form-group">
                                    <label class="col-md-4 control-label"><span style="color:#FF0011;">*</span> 学员姓名</label>
                                    <div class="col-md-6">
                                        <select class="select_name form-control" name="name">
                                            <if condition="$info['sname']">
                                                <option value="{$info['student_id']}">{$info['sname']}</option>
                                            </else>
                                                <option value="">输入学员姓名后选择学员</option>
                                            </if>
                                        </select>
                                        <input type="hidden" name="sname" id="sname" value="{$info['sname']}">
                                    </div>
                                </div>
                                <!-- 服务类别 -->
                                <div class="form-group ">
                                    <label class="col-md-4 control-label" for="server_cate_1"><span
                                            style="color:#FF0011;">*</span> 服务类别：</label>
                                    <div class="col-sm-6">
                                        <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                            <input class="form-control" type="radio" id="server_cate_1" name="server_cate" value="1" <if condition="$info['server_cate'] == 1">checked</if>/>
                                            <label for="server_cate_1">接机服务</label>
                                        </div>
                                        <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                            <input class="form-control" type="radio" id="server_cate_2" name="server_cate" value="2" <if condition="$info['server_cate'] == 2">checked</if>/>
                                            <label for="server_cate_2">住宿服务</label>
                                        </div>
                                        <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                            <input class="form-control" type="radio" id="server_cate_3" name="server_cate" value="3" <if condition="$info['server_cate'] == 3">checked</if>/>
                                            <label for="server_cate_3">手机服务</label>
                                        </div>
                                    </div>
                                </div>

                                <hr>
                                <!-- 接机相关 -->
                                <div class="server_cate" id="receive">
                                    <!-- 航班号 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 航班号</label>
                                        <div class="col-md-6">
                                            <input value="{$info['flight_number']}" class="form-control" type="text" name="flight_number" id="flight_number" placeholder="请填写航班号码"/>
                                        </div>
                                    </div>
                                    <!-- 起飞机场 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 起飞机场</label>
                                        <div class="col-md-6">
                                            <input value="{$info['start_airport']}" class="form-control" type="text" name="start_airport" id="start_airport" placeholder="请填写起飞机场"/>
                                        </div>
                                    </div>
                                    <!-- 起飞时间 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 起飞时间</label>
                                        <div class="col-md-6">
                                            <input value="{$info['start_time']}" type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'})" style="width: 100%;" name="start_time" id="start_time" class="input_edit edit form-control">
                                        </div>
                                    </div>
                                    <!-- 到达机场 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 到达机场</label>
                                        <div class="col-md-6">
                                            <input value="{$info['arrive_airport']}" class="form-control " type="text" name="arrive_airport" id="arrive_airport" placeholder="请填写到达机场"/>
                                        </div>
                                    </div>
                                    <!-- 到达时间 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 到达时间</label>
                                        <div class="col-md-6">
                                            <input value="{$info['arrive_time']}" type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'})" style="width: 100%;" name="arrive_time" id="arrive_time" class="input_edit edit form-control">
                                        </div>
                                    </div>
                                </div>

                                <!-- 住宿相关 -->
                                <div class="server_cate" id="dorm">
                                    <!-- 宿舍类型 -->
                                    <div class="form-group ">
                                        <label class="col-md-4 control-label" for="dorm_cate_1"><span
                                                style="color:#FF0011;">*</span> 宿舍类型：</label>
                                        <div class="col-sm-6">
                                            <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                                <input class="form-control" type="radio" id="dorm_cate_1" name="dorm_cate" value="1" <if condition="$info['dorm_cate'] == 1">checked="checked"</if>/>
                                                <label for="dorm_cate_1">学校宿舍</label>
                                            </div>
                                            <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                                <input class="form-control" type="radio" id="dorm_cate_2" name="dorm_cate" value="2" <if condition="$info['dorm_cate'] == 2">checked="checked"</if>/>
                                                <label for="dorm_cate_2">自行安排</label>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 住宿地址 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 住宿地址</label>
                                        <div class="col-md-6">
                                            <input value="{$info['dorm_addr']}" class="form-control " type="text" name="dorm_addr" id="dorm_addr" placeholder="请填写住宿地址"/>
                                        </div>
                                    </div>
                                    <!-- 预期入住时间 -->
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"> 预期入住时间</label>
                                        <div class="col-md-6">
                                            <input value="{$info['come_time']}" type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'})" style="width: 100%;" name="come_time" id="come_time" class="input_edit edit form-control">
                                        </div>
                                    </div>
                                </div>

                                <!-- 手机相关 -->
                                <div class="server_cate" id="phone">
                                    <h1>手机相关字段</h1>
                                </div>


                                <hr>
                                <!-- 提醒时间 -->
                                <div class="form-group">
                                    <label class="col-md-4 control-label"> 提醒时间</label>
                                    <div class="col-md-6">
                                        <input value="{$info['notice_time']}" type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'})"
                                               style="width: 100%;" name="notice_time" id="notice_time"
                                               class="input_edit edit form-control">
                                    </div>
                                </div>
                                <!-- 负责老师 -->
                                <div class="form-group">
                                    <label class="col-md-4 control-label"> 负责老师</label>
                                    <div class="col-md-6">
                                        <input value="{$info['teacher']}" class="form-control " type="text" name="teacher" id="teacher" placeholder="请填写负责老师姓名"/>
                                    </div>
                                </div>
                                <!-- 老师联系方式 -->
                                <div class="form-group">
                                    <label class="col-md-4 control-label"> 老师联系方式</label>
                                    <div class="col-md-6">
                                        <input value="{$info['teacher_connect']}" class="form-control " type="text" name="teacher_connect" id="teacher_connect" placeholder="请填写老师联系方式"/>
                                    </div>
                                </div>
                                <!-- 状态 -->
                                <div class="form-group ">
                                    <label class="col-md-4 control-label" for="status_1"><span
                                            style="color:#FF0011;">*</span> 状态：</label>
                                    <div class="col-sm-6">
                                        <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                            <input class="form-control" type="radio" id="status_1" name="status" value="0" <if condition="$info['status'] == 0">checked="checked"</if>/>
                                            <label for="status_1">进行中</label>
                                        </div>
                                        <div class="radio radio-info radio-inline" style="margin-left: 25px;">
                                            <input class="form-control" type="radio" id="status_2" name="status" value="1" <if condition="$info['status'] == 1">checked="checked"</if>/>
                                            <label for="status_2">已完成</label>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="tfoot_div" class="clearfix">
            <div class="clearfix" id="tfoot_page">
                <div class="ibox-content" style="border-top: none;">
                    <input type="hidden" name="id" value="{$info.id}">
                    <input type="hidden" id="student_id" name="student_id" value="{$info.student_id}">
                    <div class="col-sm-offset-2" style="text-align:center;margin-left:0px;"><a href="javascript:void(0)" id="submit" class="btn btn-primary">确认修改</a></div>
                </div>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript" src="__PUBLIC__/js/uploadPreview.js"></script>
<script type="text/javascript">

    $(function() {
        $(".select_name").select2({
            ajax: {
                placeholder:'请选择',
                allowClear:true,
                url: "{:U('materials/getstudents')}",
                data: function(params) {
                    var query = {
                        "name": params.term
                    }
                    return query;
                },
                dataType: 'json',
                processResults: function(data) {
                    return {
                        results: data.data
                    };
                },
                processResults: function(data, params) {
                    if (data.status) {
                        var itemList = [];
                        //当数据对象不是{id:0,text:'ANTS'}这种形式的时候，可以使用类似此方法创建新的数组对象
                        var arr = data.data
                        for(var i = 0; i < arr.length; i++){
                            itemList.push({id: arr[i]['id'], text: arr[i]['realname']})
                        }
                        return {
                            results: itemList
                        };
                    }else{
                        return []
                    }
                },
            }
        });
    })

    // 学员选择框变更
    $(".select_name").change(function () {
        $('#sname').val($(".select_name").find("option:selected").text());// 将学员姓名赋值到隐藏域
    });
    
    if ("{:C('isMobile')}" == "1") {
        width = $('.container').width() * 0.9;
    } else {
        width = 800;
    }

    $(document).ready(function(){
        /*form表单验证*/
        $("#form").validate({

        });
    });

    // 是否选中学员
    $("#submit").click(function() {
        // 赋值
        $('#student_id').val($(".select_name").val());
        if (!$('#student_id').val()) {
            alert('请选择关联学员');
            return false;
        }
        $('#form').submit();
    });

    // 默认是接机服务
    $('.server_cate').hide();

    if ("{$info['server_cate']}" == 3){
        $('#phone').show();
    }else if("{$info['server_cate']}" == 2){
        $('#dorm').show();
    }else{
        $('#receive').show();
    }

    $('#server_cate_1').click(function () {
        $('.server_cate').hide();
        $('#receive').show();
    })

    $('#server_cate_2').click(function () {
        $('.server_cate').hide();
        $('#dorm').show();
    })

    $('#server_cate_3').click(function () {
        $('.server_cate').hide();
        $('#phone').show();
    })

</script>
<include file="Public:footer" />